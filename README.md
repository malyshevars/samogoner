# SAMOGONER AE 3000

Проект «SAMOGONER AE 3000» — это контроллер для домашнего самогонного аппарата (например Самогонный аппарат Компакт 14) на базе ESP8266 (NodeMCU) HW-364A.  
Он следит за температурой в кубе и охлаждающей воды,  переливом приемной тары и состоянием термостата, выводит данные на OLED-дисплей, подключен к Wi-Fi и выводит на сайт данные (для парсинга данных и построения графиков по процессу, [но это уже другой репозиторий](https://github.com/malyshevars/Smgnr3000)), сигнализирует о важных событиях светодиодами и зуммером, а также отправляет уведомления в Telegram, логирует события отправляя на удалённый сервер (в базу SQL) и обновление OTA.

Использовались VSCode + PlatformIO + Arduino IDE.

![Smgnr AE3000 HW-364A](https://github.com/user-attachments/assets/9019f772-5bdd-42b4-b8e9-4010f561ec2f)

---

Основные возможности:
- **Измерение температур**  
  - Два DS18B20 по шине 1-Wire.  
- **Датчик уровня жидкости**  
  - Аналоговый датчик на входе A0: обнаруживает перелив.  
- **Термостат KSD9700-55-NC**  
  - Вход D0: детектирует пропажу охлаждения.  
- **Индикация**  
  - Красный LED (D1) — аварийные события (перелив, пропало охлаждение, перегрев и т. д.).  
  - Синий LED (D7) — статус процесса.  
  - Встроенный LED (D4) — контроль работы платы.  
  - Зуммер (D8) — 4 режима звукового сигнала.  
- **Экран OLED**  
  - 0.96″ 128×64 I²C (D5=SDA, D6=SCL): время работы и текущие температуры.  
- **Управление и сброс**  
  - Кнопка (D3) сбрасывает звуковой сигнал (кроме критического режима).  
- **Связь и уведомления**  
  - Wi-Fi (WIFI_STA) + Telegram Bot — оперативные сообщения о событиях.  
  - HTTP-логирование на свой сервер (POST запросы).  
- **OTA-обновления**  
  - ArduinoOTA для прошивки «по воздуху».  
- **Встроенный веб-сервер**  
  - Статистика работы доступна по HTTP в браузере.
---
# Добавлено:

Оффлайн-режим
– Если в течение 7 с после старта или при потере связи Wi-Fi подключение не удаётся, контроллер автоматически переходит в оффлайн-режим и продолжает локальную работу по датчикам. Каждые 3 мин пытается переподключиться к сети; при удачном соединении — возобновляет веб-сервер и OTA.

Режим тестирования платы
– Endpoint /test (HTTP GET) позволяет включать/отключать тестовый режим и подставлять любые значения датчиков для отладки логики без физического подключения:

Включить тестовый режим и задать параметры: curl "http://<IP>/test?mode=on&t1=65.0&t2=30.0&liq=200&thermo=0"

Отключить тестовый режим: curl "http://<IP>/test?mode=off"

В тестовом режиме контроллер использует переданные через URL значения t1, t2, liq и thermo вместо реальных считываний. При переключении режима все флаги отправки уведомлений и логов сбрасываются, чтобы повторно отрабатывать пороговые события. В репозитории https://github.com/malyshevars/Smgnr3000 есть ПО для тестирования.
  
---

Аппаратные составляющие:
- Контроллер: ESP8266 NodeMCU (HW-364A)  
- Дисплей: OLED 0.96″ SSD1306 (I²C)  
- Температурные датчики: 2 × DS18B20 + резистор 4.7 кΩ  
- Датчик уровня жидкости (аналоговый)  
- Термостат KSD9700-55-NC (герметичный NC) с подтягивающим резистором
- Сигнальные светодиоды: 
красный + резистор 100 Ω  , 
синий + резистор 47 Ω (лучше больше) 
- Зуммер (активный пьезо)  + резистор 100 Ω  
- Кнопка с подтягивающим резистором 
- Источник питания 5 В (USB) для NodeMCU  

![image](https://github.com/user-attachments/assets/e24a5731-4792-465e-ad49-52e2e3124170)


---

Нюансы:

В config.h укажите параметры Wi-Fi и Telegram Bot Token:
const char* ssid     = "";
const char* password = "";
const char* tgBotToken = "";
const char* chatId4 = "";

Веб-страница с текущим временем работы и температурами доступна по IP-адресу контроллера.
